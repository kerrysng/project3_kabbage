<!-- <div> -->
<!-- <img src="/pages/map" alt=""> -->
  <!-- <%= form_tag '/', method: 'get' do %>
    <input type="text" class="search">
    <button class="search-btn">Search</button>
  <% end %>
</div> -->


<div class="cards_container">
<section class="fine-pic">
  <div class="fine-back center-stuff">
    <h1>Tripr</h1>
    <p>Your new photo share experience</p>
    <%= form_tag '/', method: 'get' do %>
    <input type="text" class="search form-control" placeholder="Enter in your next destination">
    <button class="btn btn-success search-btn">Search</button>
    <% end %>
  </div>
</section>

<div class="cards_container  container-fluid">
</div>

<%= render 'card_template' %>

<script>
$(document).ready(function() {

  var $searchTerm = '';
  var $limit;


  var makeAJAXCall = function (){
  $offset = $limit - 10;
  $.ajax({
    method: 'GET',
    url: '/api/cards/'
   }).done(function(result){

    selection = [];
    cards = [];



    if ($searchTerm != ''){
      i=0;
      while(result[i] != undefined){
        if(result[i].city === $searchTerm || result[i].country === $searchTerm){
          selection.push(result[i]);
        }
        i++;
      }

    }
    else {
      selection = result;
    }

    for(i=$offset; i< $limit; i++){
      if(result[i] != undefined){
        cards.push(new Card(selection[i]));
      }
    }

    cards.forEach(function(card){
  //    debugger;
      if (card.attributes.id != undefined){
        var view = new CardItemView({model: card});
        $('.cards_container').append(view.render().el);
      }
    });

     $limit += 10;

   });

  }

  // load first ten elements on page load
  $limit =10;
  makeAJAXCall();

  $(".search-btn").click(function(event){

    event.preventDefault();

    // make this case insensitive
    $searchTerm = $('.search').val();
    $limit = 10;
    $(".cards_container").empty();

    makeAJAXCall();

  });


  $(window).scroll(function() {
    if($(window).scrollTop() + $(window).height() == $(document).height()) {

      makeAJAXCall();

    }

  });

// reload on click, extract information from search bar
// outside of document ready? should only be used after the document is
// ready anyway

});
</script>
